---
- hosts: webserver
  tasks:
    - include_vars: "webserver_config.yml"
    - name: "Install nginx"
      apt:
        name: nginx
        state: present
    - name: "Create/Set the default site"
      template:
        src: nginx_default.conf.j2
        dest: "{{ nginx.config_dir }}/sites-available/default"
      notify:
        - reload nginx
    - name: "Make sure nginx is at least running"
      service:
        name: nginx
        state: started
        enabled: yes
  handlers:
    - name: reload nginx
      service:
        name: nginx
        state: reloaded
        
